# 002 — Project Management: Implementation

## What Was Built

Full CRUD for testing projects: create, edit, archive (soft delete), list with search, tag filtering, and pagination. Django admin manages user-project membership and can unarchive projects.

## Architecture

### Data Model

- **Tag**: `name` (CharField, unique, indexed) — normalized to lowercase on creation
- **Project**: `name`, `tags` (M2M to Tag), `members` (M2M to CustomUser), `archived` (bool, indexed), `created_at`, `updated_at`
- Creator is auto-added as a member on project creation

### Service Layer

| Function | Purpose |
|----------|---------|
| `create_project(user, name, tag_names)` | Create project, sync tags, add creator as member (atomic) |
| `update_project(project, name, tag_names)` | Update name and tags (atomic) |
| `archive_project(project)` | Soft delete — sets `archived=True` |
| `unarchive_project(project)` | Restore — sets `archived=False` (admin use) |
| `get_project_for_user(project_id, user)` | Get non-archived project if user is member |
| `get_project_by_id(project_id, user)` | Get project (any status) if user is member |
| `list_projects_for_user(user, search, tag_filter, page, per_page)` | Paginated, filtered list |
| `get_all_tags_for_user(user)` | Tags from user's active projects (filter dropdown) |
| `_normalize_tag_names(tag_names)` | Lowercase, strip, deduplicate |
| `_get_or_create_tags(names)` | Get or create Tag instances |
| `_sync_tags(project, tag_names)` | Orchestrates normalization + creation + M2M set |

Tag normalization (lowercase, strip, dedup) lives exclusively in the service layer. The form only parses comma-separated input into raw strings.

### Views

All function-based, `@login_required`. POST-only views use `@require_POST`.

| View | Method | URL | Behavior |
|------|--------|-----|----------|
| `project_list` | GET | `/projects/` | List with search, tag filter, pagination |
| `project_create` | POST | `/projects/create/` | Create from modal form, redirect to list |
| `project_edit` | POST | `/projects/<id>/edit/` | Edit from modal form, 404 if not member |
| `project_archive` | POST | `/projects/<id>/archive/` | Archive, 404 if not member |

### Template

Single page (`projects/list.html`) extending `dashboard/base_dashboard.html`:
- Header with "New Project" button
- Search input + tag filter dropdown (GET form)
- Responsive project cards grid (1/2/3 columns)
- Pagination controls preserving search/tag params
- Create modal and edit modal (Alpine.js `x-data`, `x-show`)

### Sidebar

Removed placeholder items (Test Suites, Test Runs, Environments, Settings). Now shows Dashboard + Projects.

### Admin

- `TagAdmin`: list + search by name
- `ProjectAdmin`: list display (name, archived, created_at), filters (archived, tags), horizontal filter for M2M, bulk archive/unarchive actions

## Files

| File | Role |
|------|------|
| `projects/models.py` | Tag, Project models |
| `projects/services.py` | All business logic (CRUD, filtering, tag sync) |
| `projects/forms.py` | ProjectForm (name + comma-separated tags) |
| `projects/views.py` | 4 view functions |
| `projects/urls.py` | URL config (`app_name = "projects"`) |
| `projects/admin.py` | TagAdmin, ProjectAdmin with bulk actions |
| `projects/tests.py` | 66 test cases |
| `projects/apps.py` | AppConfig |
| `templates/projects/list.html` | Project list page with modals |
| `templates/dashboard/base_dashboard.html` | Sidebar updated (dummy items removed) |
| `sencha_qa/settings.py` | Added `"projects"` to INSTALLED_APPS |
| `sencha_qa/urls.py` | Added `projects/` URL include |

## Migrations

1. `projects/0001_initial.py` — Creates Tag table, Project table, M2M tables for tags and members

## Tests

82 total (16 existing + 66 new) across all apps:

- **TagModelTests** (3) — create, str, unique constraint
- **ProjectModelTests** (6) — create, defaults, timestamps, str, M2M tags, M2M members
- **CreateProjectServiceTests** (5) — creator membership, tag creation, reuse, empty, normalization
- **UpdateProjectServiceTests** (4) — name update, tag sync, old tag removal, new tag creation
- **ArchiveProjectServiceTests** (2) — sets archived, no hard delete
- **UnarchiveProjectServiceTests** (1) — restores archived
- **GetProjectForUserServiceTests** (4) — member access, non-member, archived, non-existent
- **GetProjectByIdServiceTests** (2) — includes archived for members, rejects non-members
- **ListProjectsForUserServiceTests** (6) — filtering, search, tag filter, empty, pagination
- **GetAllTagsForUserServiceTests** (3) — unique tags, excludes archived, empty
- **ProjectFormTests** (6) — valid, required name, comma parsing, whitespace strip, empty, messy input
- **ProjectListViewTests** (5) — auth redirect, 200, filtering, permissions
- **ProjectCreateViewTests** (4) — auth, 405 GET, create+redirect, creator membership
- **ProjectEditViewTests** (5) — auth, 405 GET, update+redirect, non-member 404, non-existent 404
- **ProjectArchiveViewTests** (4) — auth, 405 GET, archive+redirect, non-member 404
- **AdminRegistrationTests** (2) — Tag and Project registered
- **ProjectAdminActionTests** (4) — archive/unarchive actions exist and work

All pass with mypy strict mode clean.
