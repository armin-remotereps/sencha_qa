# 004. Project Test Cases - Implementation

## Overview

Added CRUD functionality for test cases within projects, integrated with TestRails field structure. Each project can have many test cases with metadata matching TestRails exports.

## Models

### TestCaseData (dataclass)
Parameter object used to pass test case field data between form, service, and model layers.

**Location:** `projects/models.py`

### TestCase (Django Model)
**Location:** `projects/models.py`

| Field | Type | Notes |
|-------|------|-------|
| project | FK -> Project | CASCADE delete |
| testrail_id | CharField(50) | Optional, e.g. C12345 |
| title | CharField(500) | Required |
| template | CharField(100) | Default: "Test Case" |
| type | CharField(50) | Choices: TestCaseType enum |
| priority | CharField(50) | Choices: TestCasePriority enum |
| estimate | CharField(50) | Optional, e.g. "1h", "30m" |
| references | CharField(500) | Optional, e.g. JIRA-123 |
| preconditions | TextField | Optional |
| steps | TextField | Optional |
| expected | TextField | Optional |
| is_converted | BooleanField | Default: False |
| created_at | DateTimeField | auto_now_add |
| updated_at | DateTimeField | auto_now |

### Enums
- `TestCaseType`: Acceptance, Accessibility, Automated, Compatibility, Destructive, Functional, Other, Performance, Regression, Security, Smoke & Sanity, Usability
- `TestCasePriority`: 1 - Don't Test, 2 - Test If Time, 3 - Test If Time, 4 - Must Test, 5 - Must Test

## Service Layer

**Location:** `projects/services.py`

| Function | Description |
|----------|-------------|
| `create_test_case(project, data)` | Creates a test case using TestCaseData |
| `update_test_case(test_case, data)` | Updates all fields from TestCaseData |
| `delete_test_case(test_case)` | Deletes from DB |
| `get_test_case_for_project(id, project)` | Returns TestCase or None, enforces project boundary |
| `list_test_cases_for_project(project, search, page, per_page)` | Paginated listing with title search |

## Views

**Location:** `projects/views.py`

| View | Method | URL | Description |
|------|--------|-----|-------------|
| `test_case_list` | GET | `/<project_id>/test-cases/` | Paginated list with search |
| `test_case_create` | POST | `/<project_id>/test-cases/create/` | Create via modal form |
| `test_case_edit` | POST | `/<project_id>/test-cases/<id>/edit/` | Edit via modal form |
| `test_case_delete` | POST | `/<project_id>/test-cases/<id>/delete/` | Delete test case |

All views use `@project_membership_required` decorator for access control.

## Decorator

**Location:** `projects/decorators.py`

`project_membership_required` - Reusable decorator that:
1. Requires login (composes with `@login_required`)
2. Validates user is a member of the project
3. Blocks access to archived projects
4. Injects `project` object into the view function (replaces `project_id`)

## Form

**Location:** `projects/forms.py`

`TestCaseForm` - All test case fields with ShadCN-styled widgets. Includes `to_data()` method that converts cleaned form data to `TestCaseData` dataclass.

## Template

**Location:** `templates/projects/test_cases.html`

- Breadcrumb navigation (Projects / Project Name / Test Cases)
- Search bar with title filtering
- Table view with Title, Type, Priority, Converted columns
- Create modal with all fields
- Edit modal with Alpine.js data binding (pre-filled from data attributes)
- Pagination controls
- "Test Cases" link added to project cards in `templates/projects/list.html`

## Admin

**Location:** `projects/admin.py`

`TestCaseAdmin` with list_display, list_filter, and search_fields configured.

## Tests

**Location:** `projects/tests.py` (46 new tests, 112 total)

- 4 model tests (creation, defaults, str, cascade delete)
- 12 service tests (CRUD, get, list, search, pagination, project boundaries)
- 7 form tests (validation, choices, defaults, to_data)
- 19 view tests (auth, membership, CRUD, cross-project security, archived access)
- 4 admin tests (registration, display, filters, search)

## Migration

`projects/migrations/0002_testcase.py` - Creates TestCase table with all fields and FK to Project.
