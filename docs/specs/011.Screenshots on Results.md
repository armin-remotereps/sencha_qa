# Screenshots on Test Run Results

## Description

Screenshots are already captured and persisted during AI test execution (via `TestRunScreenshot` model), and they are shown live on the individual test case detail page via WebSocket. However, when reviewing completed test runs, users have to click into each individual test case to see its screenshots. We need to surface screenshots directly on the **test run detail page** (the results overview) so users can quickly visually verify what happened across all test cases without drilling into each one.

## Current State

- `TestRunScreenshot` model stores screenshots linked to `TestRunTestCase` (FK with `related_name="screenshots"`)
- `test_run_case_detail.html` already renders all screenshots for a single test case (live via WebSocket + initial server render)
- `test_run_detail.html` shows a table of test cases with status badges but **no screenshots at all**
- The view `test_run_detail` does not prefetch or pass screenshot data

## Requirements

### 1. Test Run Detail Page — Last Screenshot Thumbnail per Case
- In the test cases table on `test_run_detail.html`, add a **thumbnail column** showing the **last screenshot** (most recent `created_at`) for each completed test case
- The thumbnail should be small (e.g., 80x60px) and clickable — clicking opens the full image in a new tab
- Cases with no screenshots should show a placeholder dash or empty cell
- This gives a quick visual summary without overwhelming the page

### 2. Test Run Case Detail Page — Improved Screenshot Gallery
- The existing screenshots section on `test_run_case_detail.html` already works, but improve the UX:
  - Add a **lightbox/modal** for viewing screenshots at full size without leaving the page (click thumbnail to open overlay, click outside or press Escape to close)
  - Show screenshot **count** in the section header (e.g., "Screenshots (5)")

### 3. Performance
- Prefetch screenshots in the `test_run_detail` view query to avoid N+1 queries (use `Prefetch` with ordering and slicing, or annotate with last screenshot)
- Keep the existing WebSocket flow untouched — this is only for the server-rendered results view of completed/cancelled runs

## Out of Scope
- No changes to the screenshot capture pipeline or WebSocket broadcasting
- No changes to the `TestRunScreenshot` model
- No REST API — this is all server-rendered templates with Alpine.js for interactivity

## Verification
- Uncle bob for code review
- Nightmare tester for UI
